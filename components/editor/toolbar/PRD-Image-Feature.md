# 📄 **产品需求文档（PRD）：简历编辑器图片功能**

## 1. 产品概述

### 1.1 产品愿景
为简历编辑器提供完整的图片插入、编辑、操作功能，让用户能够轻松在简历中添加和调整个人照片、作品截图、证书等图片元素。

### 1.2 目标用户
- **主要用户**：求职者（23-35岁）
- **次要用户**：HR、猎头、招聘经理
- **使用场景**：制作个人简历、招聘需求文档

### 1.3 价值主张
- 提升简历视觉效果
- 简化图片编辑操作
- 提供专业级布局工具

---

## 2. 功能清单

### 2.1 核心功能（P0 - 必须实现）

| 功能名称 | 功能描述 | 优先级 | 预计工期 |
|----------|----------|--------|----------|
| **图片插入** | 支持点击上传和Ctrl+V粘贴两种方式 | P0 | 1天 |
| **图片选中** | 点击图片显示蓝色控制点，指示可编辑状态 | P0 | 0.5天 |
| **拖动移动** | 拖拽图片到任意位置，拖动时显示位置变化 | P0 | 1天 |
| **缩放调整** | 拖拽四个角控制点调整大小，自动保持宽高比 | P0 | 1天 |
| **删除图片** | 通过Delete键或点击删除按钮移除图片 | P0 | 0.5天 |

### 2.2 增强功能（P1 - 推荐实现）

| 功能名称 | 功能描述 | 优先级 | 预计工期 |
|----------|----------|--------|----------|
| **对齐工具** | 左对齐、居中、右对齐、两端对齐 | P1 | 1天 |
| **尺寸预设** | 小图（50px）、中图（100px）、大图（200px） | P1 | 0.5天 |
| **智能吸附** | 拖动时自动吸附到其他元素边缘 | P1 | 1.5天 |
| **重置尺寸** | 恢复到插入时的初始大小 | P1 | 0.5天 |
| **撤消重做** | 支持Ctrl+Z/Y撤销/重做图片操作 | P1 | 1天 |

### 2.3 高级功能（P2 - 长期规划）

| 功能名称 | 功能描述 | 优先级 | 预计工期 |
|----------|----------|--------|----------|
| **透明度调整** | 0-100%透明度设置 | P2 | 1天 |
| **边框样式** | 添加边框、调整宽度/颜色/圆角 | P2 | 1.5天 |
| **旋转功能** | 90度旋转或任意角度旋转 | P2 | 1天 |
| **层级管理** | 置于顶层/底层、上移/下移一层 | P2 | 1天 |
| **多图操作** | 同时选中多个图片批量操作 | P2 | 2天 |
| **右键菜单** | 复制、粘贴、对齐等快捷操作 | P2 | 1.5天 |

---

## 3. 详细功能设计

### 3.1 图片插入功能

#### 3.1.1 点击上传
**交互流程：**
1. 用户点击工具栏"图片"按钮
2. 弹出文件选择对话框
3. 用户选择图片文件（支持JPG/PNG/GIF/WebP）
4. 验证文件大小（≤5MB）
5. 预览图片并确认插入
6. 光标位置插入图片
7. 自动选中图片，显示控制点

**限制条件：**
- 格式：仅支持 JPG、PNG、GIF、WebP
- 大小：单张图片 ≤ 5MB
- 尺寸：自动调整到合适大小（最大宽度800px）

#### 3.1.2 Ctrl+V粘贴
**交互流程：**
1. 用户在任意应用复制图片
2. 回到编辑器，按Ctrl+V
3. 系统检测剪贴板中的图片数据
4. 验证格式和大小
5. 光标位置插入图片
6. 自动选中图片，显示控制点

**限制条件：**
- 环境：需要HTTPS或localhost（浏览器安全限制）
- 格式：与点击上传一致
- 大小：与点击上传一致

---

### 3.2 图片选中功能

#### 3.2.1 选中状态
**视觉反馈：**
- 显示4个蓝色圆形控制点（直径12px）
- 控制点位置：图片四角向外延伸6px
- 控制点样式：蓝色背景（#3b82f6）+ 白色边框（2px）+ 圆角 + 阴影

#### 3.2.2 选中规则
- 点击图片空白区域：选中图片
- 点击图片上的控制点：进入缩放模式
- 点击图片外区域：取消选中，隐藏控制点
- 多张图片：不支持多选（后续版本考虑）

---

### 3.3 拖动移动功能

#### 3.3.1 拖动规则
- **触发条件**：选中图片后，拖拽图片主体（不是控制点）
- **移动范围**：可在整个页面内自由移动
- **拖动方式**：按下鼠标 → 移动鼠标 → 释放鼠标
- **最小移动**：移动超过3px才开始移动（避免误触）

#### 3.3.2 视觉反馈
- 拖动时图片跟随鼠标实时移动
- 可添加半透明效果（可选）
- 释放鼠标后图片固定在新位置

#### 3.3.3 智能辅助（V1.1）
- **自动吸附**：距离其他元素（文字、表格）≤10px时自动吸附
- **对齐参考线**：移动时显示水平/垂直对齐参考线
- **吸附提示**：吸附时显示虚线提示

---

### 3.4 缩放调整功能

#### 3.4.1 缩放规则
- **触发方式**：拖拽四个角控制点
- **缩放比例**：自动保持宽高比（锁定比例）
- **最小尺寸**：20x20px
- **最大尺寸**：不超过页面边界

#### 3.4.2 缩放逻辑
- **右下角**：向右下拖动 → 放大；向左上拖动 → 缩小
- **右上角**：向右上拖动 → 放大；向左下拖动 → 缩小
- **左下角**：向左下拖动 → 放大；向右上拖动 → 缩小
- **左上角**：向左上拖动 → 放大；向右下拖动 → 缩小

#### 3.4.3 视觉反馈
- 拖动时控制点位置实时更新
- 可显示当前尺寸提示（可选）
- 释放鼠标后固定新尺寸

---

### 3.5 删除功能

#### 3.5.1 删除方式
1. **键盘删除**：选中图片后按Delete键
2. **按钮删除**：在图片上方或控制点附近添加删除按钮（×）

#### 3.5.2 删除确认
- **选项A**：直接删除（无确认弹窗）
- **选项B**：显示确认弹窗"确定要删除这张图片吗？"

**建议**：采用选项A（直接删除），因为图片删除是可逆操作（可Ctrl+Z撤销）

---

## 4. 界面设计

### 4.1 工具栏设计

```
[图片] [链接] [表格] [颜色] [对齐] ...
          ↑
      点击后弹出文件选择框
```

### 4.2 控制点设计

```
┌─────────────────────────┐
│  ●                    ● │  ← 12px蓝色圆点
│                         │
│      [图片内容]         │
│                         │
│  ●                    ● │
└─────────────────────────┘
```

**控制点详情：**
- 颜色：#3b82f6（蓝色）
- 大小：12px
- 边框：2px白色
- 圆角：50%（圆形）
- 阴影：0 0 3px rgba(0,0,0,0.5)

### 4.3 对齐工具设计

```
[左对齐] [居中] [右对齐] [两端对齐]
```

### 4.4 尺寸预设按钮

```
[小 50px] [中 100px] [大 200px] [重置]
```

---

## 5. 用户体验

### 5.1 操作引导

**首次使用提示：**
```
💡 提示：点击图片可显示控制点
   - 拖拽图片可移动位置
   - 拖拽控制点可调整大小
   - 按Delete键可删除图片
```

### 5.2 快捷键

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| 粘贴图片 | Ctrl+V | 粘贴剪贴板中的图片 |
| 撤销操作 | Ctrl+Z | 撤销上一次操作 |
| 重做操作 | Ctrl+Y | 重做上一次撤销 |
| 删除图片 | Delete | 删除选中的图片 |

### 5.3 状态提示

| 场景 | 提示文案 | 显示时长 |
|------|----------|----------|
| 粘贴成功 | "图片已插入" | 2秒 |
| 粘贴失败-格式 | "粘贴失败：仅支持JPG/PNG/GIF/WebP" | 5秒 |
| 粘贴失败-大小 | "粘贴失败：图片超过5MB" | 5秒 |
| 删除成功 | "图片已删除" | 2秒 |

---

## 6. 技术实现

### 6.1 技术栈
- **前端框架**：React + TypeScript
- **样式方案**：Tailwind CSS
- **事件处理**：原生JavaScript事件
- **图片处理**：浏览器原生API（FileReader、Clipboard API）

### 6.2 核心组件

#### 6.2.1 EditablePreview
- 负责编辑器主体
- 管理iframe内容
- 处理图片插入和粘贴

#### 6.2.2 addImageResizer
- 为图片添加交互能力
- 处理选中、拖动、缩放
- 动态创建控制点

#### 6.2.3 ImagePicker
- 点击上传图片
- 文件选择和验证
- 转换为base64并插入

### 6.3 关键算法

#### 6.3.1 图片缩放算法
```javascript
// 保持宽高比缩放
const aspectRatio = width / height
const newWidth = newWidth
const newHeight = newWidth / aspectRatio
```

#### 6.3.2 拖动位置计算
```javascript
// 累积偏移量计算
const newLeft = startLeft + (currentX - startX)
const newTop = startTop + (currentY - startY)
```

#### 6.3.3 智能吸附检测
```javascript
// 距离计算
const distance = Math.abs(element1.x - element2.x)
if (distance <= 10) {
  // 吸附到对齐线
}
```

---

## 7. 兼容性

### 7.1 浏览器支持
- **Chrome**：完全支持（推荐）
- **Firefox**：完全支持
- **Safari**：完全支持
- **Edge**：完全支持

### 7.2 设备支持
- **桌面端**：完全支持
- **平板**：部分支持（触摸操作体验可能不同）
- **手机**：暂不支持（屏幕太小，操作困难）

---

## 8. 性能要求

### 8.1 响应时间
- 图片插入：≤ 1秒
- 控制点显示：≤ 100ms
- 拖动响应：≤ 16ms（60fps）

### 8.2 文件大小
- 单张图片：≤ 5MB
- 总图片数量：≤ 20张（建议）
- base64编码后增加33%大小

---

## 9. 测试用例

### 9.1 功能测试
1. **插入测试**：
   - [ ] 点击上传JPG图片
   - [ ] 点击上传PNG图片
   - [ ] 点击上传GIF图片
   - [ ] 点击上传WebP图片
   - [ ] 粘贴图片（网页截图）
   - [ ] 粘贴图片（本地文件）
   - [ ] 上传超过5MB图片（应失败）
   - [ ] 上传不支持格式（应失败）

2. **操作测试**：
   - [ ] 点击图片显示控制点
   - [ ] 拖动图片到新位置
   - [ ] 拖动右下角控制点放大
   - [ ] 拖动左上角控制点缩小
   - [ ] 按Delete键删除图片
   - [ ] 拖动时保持宽高比

3. **边界测试**：
   - [ ] 拖动到页面边缘
   - [ ] 缩小到最小尺寸（20px）
   - [ ] 快速连续拖动
   - [ ] 同时打开多个图片

### 9.2 用户体验测试
1. **易用性测试**：
   - 新用户5分钟内完成首次图片插入
   - 无需培训即可理解控制点作用
   - 操作流程符合用户直觉

2. **性能测试**：
   - 插入10张图片后编辑器仍然流畅
   - 拖动时无卡顿现象
   - 内存使用正常（无内存泄漏）

---

## 10. 发布计划

### 10.1 MVP版本（本周）
- [ ] 图片插入（点击 + 粘贴）
- [ ] 选中显示控制点
- [ ] 拖动移动
- [ ] 缩放调整
- [ ] 删除功能

### 10.2 V1.1版本（下周）
- [ ] 对齐工具
- [ ] 尺寸预设
- [ ] 智能吸附
- [ ] 重置尺寸
- [ ] 撤消重做

### 10.3 V2.0版本（下月）
- [ ] 透明度调整
- [ ] 边框样式
- [ ] 旋转功能
- [ ] 层级管理
- [ ] 多图操作
- [ ] 右键菜单

---

## 11. 风险评估

| 风险项 | 影响程度 | 概率 | 应对措施 |
|--------|----------|------|----------|
| 粘贴功能兼容性差 | 高 | 中 | 提供替代方案（点击上传） |
| 拖动性能问题 | 中 | 低 | 优化事件处理，使用requestAnimationFrame |
| 跨域安全限制 | 中 | 中 | 仅在HTTPS或localhost使用粘贴功能 |
| 移动端体验差 | 中 | 高 | 明确不支持移动端 |
| 图片过大导致页面卡顿 | 中 | 中 | 设置5MB限制，提供压缩建议 |

---

## 12. 成功指标

### 12.1 功能指标
- **图片插入成功率**：≥ 95%
- **拖动流畅度**：≥ 60fps
- **控制点显示率**：100%（无bug）
- **删除操作成功率**：100%

### 12.2 用户满意度
- **首次使用成功率**：≥ 90%
- **操作学习时间**：≤ 2分钟
- **用户投诉率**：≤ 1%

---

## 13. 后续迭代

### 13.1 增值功能
- 图片云端存储和CDN加速
- AI智能裁剪和优化
- 模板库（证件照、项目截图等）
- 批量图片处理

### 13.2 技术优化
- Web Workers处理大图片
- 虚拟滚动优化大量图片
- 图片懒加载
- 增量更新减少重绘

---

**文档版本**：V1.0
**创建日期**：2025-11-08
**最后更新**：2025-11-08
**负责人**：产品经理 & 技术负责人
