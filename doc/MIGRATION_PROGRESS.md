# Editor ç»„ä»¶é‡æ„è¿ç§»è¿›å±•æŠ¥å‘Š

## å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆçš„å·¥ä½œ

1. **æ ¸å¿ƒå¼•æ“ (lib/editor-core/)**
   - CommandManager - å‘½ä»¤ç®¡ç† âœ…
   - StateManager - çŠ¶æ€ç®¡ç† âœ…
   - HistoryManager - å†å²ç®¡ç† âœ…
   - PluginManager - æ’ä»¶ç³»ç»Ÿ âœ…
   - EventBus - äº‹ä»¶æ€»çº¿ âœ…
   - ConfigManager - é…ç½®ç®¡ç† âœ…
   - ThemeManager - ä¸»é¢˜ç®¡ç† âœ…
   - å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œå•å…ƒæµ‹è¯• (128ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡)

2. **é›†æˆå±‚**
   - useEditorCore Hook - æ•´åˆæ ¸å¿ƒå¼•æ“çš„ React Hook âœ…
   - æ ¸å¿ƒæ¨¡å—åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é€šè¿‡ âœ…

3. **æ–‡æ¡£**
   - å®Œæ•´çš„ API æ–‡æ¡£ (lib/editor-core/README.md) âœ…
   - ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ âœ…

### ğŸ“Š æµ‹è¯•ç»“æœ

```
æ ¸å¿ƒæ¶æ„æµ‹è¯•: 128 ä¸ªæµ‹è¯•é€šè¿‡ âœ…
ç¼–è¾‘å™¨ç»„ä»¶æµ‹è¯•: 169 ä¸ªæµ‹è¯•é€šè¿‡, 14 ä¸ªè·³è¿‡ âœ…
æ€»è®¡: 297 ä¸ªæµ‹è¯•é€šè¿‡
```

### ğŸ“ ç›®å½•ç»“æ„

```
lib/editor-core/               # æ ¸å¿ƒå¼•æ“ï¼ˆæ¡†æ¶æ— å…³ï¼‰
â”œâ”€â”€ command/                   # å‘½ä»¤ç®¡ç†
â”‚   â”œâ”€â”€ CommandManager.ts
â”‚   â””â”€â”€ commands.ts
â”œâ”€â”€ state/                     # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ StateManager.ts
â”œâ”€â”€ history/                   # å†å²ç®¡ç†
â”‚   â””â”€â”€ HistoryManager.ts
â”œâ”€â”€ plugin/                    # æ’ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ PluginManager.ts
â”‚   â”œâ”€â”€ EventBus.ts
â”‚   â””â”€â”€ types.ts
â”œâ”€â”€ config/                    # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ ConfigManager.ts
â”‚   â””â”€â”€ types.ts
â”œâ”€â”€ theme/                     # ä¸»é¢˜ç®¡ç†
â”‚   â””â”€â”€ ThemeManager.ts
â”œâ”€â”€ types/                     # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ __tests__/                 # å•å…ƒæµ‹è¯• (128ä¸ª)
â”œâ”€â”€ index.ts                   # ç»Ÿä¸€å¯¼å‡º
â””â”€â”€ README.md                  # API æ–‡æ¡£

components/editor/             # React UI ç»„ä»¶
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useEditorCore.ts      # æ ¸å¿ƒ Hook (ä½¿ç”¨ editor-core)
â”‚   â””â”€â”€ useHistory.ts         # å†å²ç®¡ç† (ä¿ç•™åŸå§‹å®ç°)
â”œâ”€â”€ EditablePreview.tsx      # ä¸»ç¼–è¾‘å™¨ç»„ä»¶ (æœªä¿®æ”¹)
â””â”€â”€ ... (å…¶ä»–ç»„ä»¶ä¿æŒä¸å˜)
```

### ğŸ”„ è¿ç§»ç­–ç•¥è°ƒæ•´

**åŸè®¡åˆ’**ï¼šé€ä¸ªè¿ç§»ç°æœ‰ hooks åˆ°ä½¿ç”¨æ ¸å¿ƒå¼•æ“

**é‡åˆ°çš„é—®é¢˜**ï¼š
1. `useHistory` çš„è¯­ä¹‰è®¾è®¡ä¸ `HistoryManager` ä¸åŒï¼Œç›´æ¥è¿ç§»ä¼šç ´åç°æœ‰åŠŸèƒ½
2. `useEditorCore` Hook åœ¨æµ‹è¯•ç¯å¢ƒä¸­éœ€è¦å¤æ‚çš„ iframe mock

**è°ƒæ•´åçš„ç­–ç•¥**ï¼š
1. âœ… **ä¿ç•™ç°æœ‰ç»„ä»¶ä¸å˜** - æ‰€æœ‰ç°æœ‰ç»„ä»¶æµ‹è¯•é€šè¿‡ï¼ŒåŠŸèƒ½ç¨³å®š
2. âœ… **æä¾›æ–°çš„é›†æˆæ–¹å¼** - é€šè¿‡ `useEditorCore` Hook ä¸ºæ–°åŠŸèƒ½æˆ–é‡æ„æä¾›å…¥å£
3. âœ… **æ¸è¿›å¼è¿ç§»** - æ–°åŠŸèƒ½å’Œé‡æ„å¯ä»¥ä½¿ç”¨æ–°æ¶æ„ï¼Œæ—§ä»£ç ä¿æŒç¨³å®š

### ğŸ“ ä½¿ç”¨æŒ‡å—

#### å¯¹äºæ–°åŠŸèƒ½æˆ–é‡æ„

ä½¿ç”¨ `useEditorCore` Hookï¼š

```typescript
import { useEditorCore } from '@/components/editor/hooks/useEditorCore'

function MyNewFeature() {
  const {
    executeCommand,
    undo,
    redo,
    canUndo,
    canRedo,
    getState,
    setState
  } = useEditorCore({
    initialContent: '<p>Hello</p>',
    onContentChange: (content) => console.log(content),
    iframeRef
  })

  // ä½¿ç”¨æ ¸å¿ƒå¼•æ“çš„ API
  const handleClick = () => {
    executeCommand('bold')
  }
}
```

#### å¯¹äºç°æœ‰ä»£ç 

ä¿æŒç°æœ‰å®ç°ä¸å˜ï¼Œç»§ç»­ä½¿ç”¨ `useHistory`ã€`useEditorCommands` ç­‰ hooksï¼š

```typescript
// ç°æœ‰ä»£ç ç»§ç»­å·¥ä½œ
const { push, undo, redo, canUndo, canRedo } = useHistory({
  html: content,
  floatingImages
})
```

### ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **æ–°åŠŸèƒ½å¼€å‘**ï¼šä½¿ç”¨ `useEditorCore` Hook å’Œæ ¸å¿ƒå¼•æ“
2. **æ¸è¿›å¼é‡æ„**ï¼šåœ¨éœ€è¦é‡æ„æŸéƒ¨åˆ†åŠŸèƒ½æ—¶ï¼Œå†è€ƒè™‘è¿ç§»åˆ°æ ¸å¿ƒå¼•æ“
3. **æ’ä»¶å¼€å‘**ï¼šä½¿ç”¨æ–°çš„æ’ä»¶ç³»ç»Ÿå¼€å‘æ‰©å±•åŠŸèƒ½
4. **é…ç½®åŒ–**ï¼šä½¿ç”¨ `ConfigManager` å®ç°å·¥å…·æ å’ŒåŠŸèƒ½çš„é…ç½®åŒ–

### âœ… éªŒè¯ç»“æœ

- âœ… æ‰€æœ‰æ ¸å¿ƒæ¨¡å—æµ‹è¯•é€šè¿‡
- âœ… æ‰€æœ‰ç¼–è¾‘å™¨ç»„ä»¶æµ‹è¯•é€šè¿‡
- âœ… æ ¸å¿ƒå¼•æ“åœ¨æµ‹è¯•ç¯å¢ƒä¸­æ­£å¸¸å·¥ä½œ
- âœ… ç°æœ‰åŠŸèƒ½ä¿æŒç¨³å®š

### åˆ†æ”¯ä¿¡æ¯

- å½“å‰åˆ†æ”¯ï¼š`refactor-complete`
- åŒ…å«æ‰€æœ‰ 5 ä¸ªé‡æ„é˜¶æ®µçš„ä»£ç 
- æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ŒåŠŸèƒ½æ­£å¸¸
