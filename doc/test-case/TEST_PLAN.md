# Editor ç»„ä»¶æµ‹è¯•æ–¹æ¡ˆ

## ä¸€ã€æµ‹è¯•ç›®æ ‡

åœ¨é‡æ„ Editor ç»„ä»¶ä¹‹å‰ï¼Œå»ºç«‹å®Œæ•´çš„æµ‹è¯•è¦†ç›–ï¼Œç¡®ä¿ï¼š
1. ç°æœ‰åŠŸèƒ½æœ‰æµ‹è¯•ä¿æŠ¤
2. é‡æ„è¿‡ç¨‹ä¸­å¯ä»¥å¿«é€ŸéªŒè¯åŠŸèƒ½å®Œæ•´æ€§
3. é‡æ„ååŠŸèƒ½æ— å›å½’

---

## äºŒã€æµ‹è¯•èŒƒå›´

### 2.1 æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | ä¼˜å…ˆçº§ | æµ‹è¯•ç±»å‹ | æµ‹è¯•ç”¨ä¾‹æ•° |
|------|----------|------|--------|----------|-----------|
| EditablePreview | components/editor/EditablePreview.tsx | 1017 | P0 | é›†æˆæµ‹è¯• | 41 |
| FloatingImageLayer | components/editor/FloatingImageLayer.tsx | 374 | P1 | äº¤äº’æµ‹è¯• | 24 |
| ImageResizer | components/editor/ImageResizer.tsx | 188 | P1 | äº¤äº’æµ‹è¯• | 25 |
| useEditorCommands | components/editor/toolbar/hooks/useEditorCommands.ts | 404 | P1 | å•å…ƒæµ‹è¯• | 35 |
| **å°è®¡** | - | **1983** | - | - | **133** |

### 2.2 å…¶ä»–ç»„ä»¶

| ç»„ä»¶ | æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | å¤æ‚åº¦ | æµ‹è¯•ç”¨ä¾‹æ•° |
|------|----------|------|--------|-----------|
| TableSmartToolbar | components/editor/toolbar/TableSmartToolbar.tsx | 686 | â­â­â­â­â­ | 45 |
| SmartContextMenu | components/editor/toolbar/SmartContextMenu.tsx | 153 | â­â­â­ | 18 |
| TablePicker | components/editor/toolbar/pickers/TablePicker.tsx | 119 | â­â­ | 4 |
| ImagePicker | components/editor/toolbar/pickers/ImagePicker.tsx | 102 | â­â­ | 3 |
| ColorPicker | components/editor/toolbar/pickers/ColorPicker.tsx | 147 | â­â­ | 2 |
| ColorGrid | components/editor/toolbar/pickers/ColorGrid.tsx | 60 | â­ | 2 |
| ToolbarSelect | components/editor/toolbar/ToolbarSelect.tsx | 73 | â­ | 2 |
| **å°è®¡** | - | **1338** | - | **76** |

### 2.3 æ€»è®¡ç»Ÿè®¡

| ç±»åˆ« | ç»„ä»¶æ•° | ç”¨ä¾‹æ•° |
|------|--------|--------|
| æ ¸å¿ƒç»„ä»¶ | 4 | 133 |
| å…¶ä»–ç»„ä»¶ | 7 | 76 |
| **æ€»è®¡** | **11** | **209** |

### 2.4 å·²æœ‰æµ‹è¯•ï¼ˆéœ€éªŒè¯é€šè¿‡ï¼‰

| ç»„ä»¶ | æµ‹è¯•æ–‡ä»¶ | çŠ¶æ€ |
|------|----------|------|
| useHistory | __tests__/components/editor/hooks/useHistory.test.ts | âœ… å·²æœ‰ |
| EditorToolbar | components/editor/EditorToolbar.test.tsx | âœ… å·²æœ‰ |
| useEditorState | components/editor/toolbar/hooks/useEditorState.test.ts | âœ… å·²æœ‰ |
| ButtonRenderer | components/editor/toolbar/core/ButtonRenderer.test.tsx | âœ… å·²æœ‰ |
| table utils | components/editor/utils/table.test.ts | âœ… å·²æœ‰ |
| style utils | __tests__/components/editor/utils/style.test.ts | âœ… å·²æœ‰ |

---

## ä¸‰ã€é«˜é£é™©ç”¨ä¾‹æ¸…å•

ä»¥ä¸‹ç”¨ä¾‹è¢«æ ‡è®°ä¸ºé«˜é£é™©ï¼ˆğŸ”´ï¼‰ï¼Œéœ€è¦ä¼˜å…ˆç¼–å†™å’ŒéªŒè¯ï¼š

| ç”¨ä¾‹ID | ç»„ä»¶ | æµ‹è¯•é¡¹ | é£é™©åŸå›  |
|--------|------|--------|----------|
| TC-FI-022 | FloatingImageLayer | é›¶é«˜åº¦å›¾ç‰‡ratioå¤„ç† | height=0 æ—¶å¯èƒ½å¯¼è‡´é™¤ä»¥0å´©æºƒ |
| TC-EC-032 | useEditorCommands | æ ¼å¼åˆ·è‡ªåŠ¨åº”ç”¨ | é€»è¾‘å¤æ‚ï¼Œæ¶‰åŠé€‰æ‹©æ¢å¤ã€æ ·å¼åº”ç”¨ç­‰å¤šæ­¥æ“ä½œ |

---

## å››ã€æ ¸å¿ƒç»„ä»¶æµ‹è¯•ç”¨ä¾‹

### 4.1 ImageResizer.tsx

**æµ‹è¯•æ–‡ä»¶**: `components/editor/ImageResizer.test.tsx`

#### åœºæ™¯ 1: åŸºç¡€æ¸²æŸ“

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-IR-001 | ä¸æ¸²æŸ“ï¼ˆtargetä¸ºnullï¼‰ | target=null, iframeDoc=null | container.firstChild ä¸º null |
| TC-IR-002 | ä¸æ¸²æŸ“ï¼ˆiframeDocä¸ºnullï¼‰ | target=HTMLElement, iframeDoc=null | container.firstChild ä¸º null |
| TC-IR-003 | æ­£å¸¸æ¸²æŸ“ | target=imgå…ƒç´ , iframeDoc=Document | æ˜¾ç¤ºè¦†ç›–å±‚ï¼ŒåŒ…å«8ä¸ªè°ƒæ•´æ‰‹æŸ„ |

#### åœºæ™¯ 2: è°ƒæ•´æ‰‹æŸ„æ˜¾ç¤º

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|
| TC-IR-004 | 8ä¸ªæ‰‹æŸ„å…¨éƒ¨æ˜¾ç¤º | æ‰¾åˆ°8ä¸ª .resizer-handle å…ƒç´  |
| TC-IR-005 | æ‰‹æŸ„ä½ç½®æ­£ç¡® | æ‰‹æŸ„è¦†ç›–åœ¨å›¾ç‰‡è¾¹ç•Œä¸Šï¼Œä½ç½®: nw, n, ne, e, se, s, sw, w |

#### åœºæ™¯ 3: è°ƒæ•´å¤§å°äº¤äº’

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-IR-006 | å³ä¸‹è§’æ‰‹æŸ„æ‹–åŠ¨ | mousedown SE handle â†’ mousemove(50,50) â†’ mouseup | å›¾ç‰‡å®½åº¦å¢åŠ ~50pxï¼Œé«˜åº¦ç›¸åº”å¢åŠ  |
| TC-IR-007 | å³ä¾§æ‰‹æŸ„æ‹–åŠ¨ | mousedown E handle â†’ mousemove(50,0) â†’ mouseup | åªæ”¹å˜å®½åº¦ï¼Œé«˜åº¦ä¸å˜ |
| TC-IR-008 | åº•éƒ¨æ‰‹æŸ„æ‹–åŠ¨ | mousedown S handle â†’ mousemove(0,50) â†’ mouseup | åªæ”¹å˜é«˜åº¦ï¼Œå®½åº¦ä¸å˜ |
| TC-IR-009 | å·¦ä¸Šè§’æ‰‹æŸ„æ‹–åŠ¨ | mousedown NW handle â†’ mousemove(-20,-20) â†’ mouseup | å›¾ç‰‡å˜å¤§ï¼Œä¸”ä½ç½®å‘å·¦ä¸Šç§»åŠ¨ |

#### åœºæ™¯ 4: å®½é«˜æ¯”ä¿æŒ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | åˆå§‹æ¡ä»¶ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|----------|------|----------|
| TC-IR-010 | è§’è½æ‰‹æŸ„ä¿æŒå®½é«˜æ¯” | 200x150 (ratio=1.33) | æ‹–åŠ¨SEæ‰‹æŸ„ï¼Œå®½åº¦å˜ä¸º250 | é«˜åº¦è‡ªåŠ¨å˜ä¸º~188 (ä¿æŒ1.33æ¯”ä¾‹) |
| TC-IR-011 | è¾¹ç¼˜æ‰‹æŸ„ä¸ä¿æŒå®½é«˜æ¯” | ä»»æ„å°ºå¯¸ | æ‹–åŠ¨Eæˆ–Sæ‰‹æŸ„ | è‡ªç”±è°ƒæ•´ï¼Œä¸å¼ºåˆ¶å®½é«˜æ¯” |

#### åœºæ™¯ 5: æœ€å°å°ºå¯¸é™åˆ¶

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-IR-012 | æœ€å°å®½åº¦20px | å°è¯•å°†å®½åº¦è°ƒæ•´ä¸º10px | å®é™…å®½åº¦ä¸º20px |
| TC-IR-013 | æœ€å°é«˜åº¦20px | å°è¯•å°†é«˜åº¦è°ƒæ•´ä¸º10px | å®é™…é«˜åº¦ä¸º20px |

#### åœºæ™¯ 6: ResizeObserver é›†æˆ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-IR-014 | ç›‘å¬å›¾ç‰‡å°ºå¯¸å˜åŒ– | ä¿®æ”¹img.style.width | ResizeObserverå›è°ƒè¢«è§¦å‘ |
| TC-IR-015 | è¦†ç›–å±‚ä½ç½®è‡ªåŠ¨æ›´æ–° | å›¾ç‰‡å°ºå¯¸å˜åŒ–å | è¦†ç›–å±‚ä½ç½®åŒæ­¥æ›´æ–° |

#### åœºæ™¯ 7: å›è°ƒä¸æ¸…ç†

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-IR-016 | è°ƒæ•´ç»“æŸåè°ƒç”¨onUpdate | å®Œæˆä¸€æ¬¡æ‹–åŠ¨ | onUpdateè¢«è°ƒç”¨ |
| TC-IR-017 | ç»„ä»¶å¸è½½æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬ | unmountç»„ä»¶ | removeEventListenerè¢«è°ƒç”¨ |
| TC-IR-018 | ç»„ä»¶å¸è½½æ—¶æ–­å¼€ResizeObserver | unmountç»„ä»¶ | disconnect()è¢«è°ƒç”¨ |

#### åœºæ™¯ 8: æ ·å¼å’Œå®šä½

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-IR-019 | z-indexä¸ºæœ€å¤§å€¼ | æ­£å¸¸æ¸²æŸ“ | style.zIndex === '2147483647' |
| TC-IR-020 | è¦†ç›–å±‚ä½ç½®ä¸å›¾ç‰‡ä¸€è‡´ | å›¾ç‰‡rect={top:100, left:50, width:200, height:150} | è¦†ç›–å±‚top=100px, left=50px |

#### åœºæ™¯ 9: äº‹ä»¶ç›‘å¬å™¨

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-IR-021 | çª—å£resizeæ—¶æ›´æ–°ä½ç½® | è§¦å‘iframe window.resizeäº‹ä»¶ | updateRectè¢«è°ƒç”¨ï¼Œè¦†ç›–å±‚ä½ç½®æ›´æ–° |
| TC-IR-022 | iframeæ»šåŠ¨æ—¶æ›´æ–°ä½ç½® | è§¦å‘iframe window.scrolläº‹ä»¶ | updateRectè¢«è°ƒç”¨ï¼Œè¦†ç›–å±‚ä½ç½®æ›´æ–° |
| TC-IR-023 | å†…å®¹æ”¹å˜æ—¶æ›´æ–°ä½ç½® | è§¦å‘iframe.inputäº‹ä»¶ | updateRectè¢«è°ƒç”¨ï¼Œè¦†ç›–å±‚ä½ç½®æ›´æ–° |

#### åœºæ™¯ 10: è¦†ç›–å±‚æ ·å¼

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | éªŒè¯å†…å®¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-IR-024 | è¦†ç›–å±‚è“è‰²è¾¹æ¡† | æ£€æŸ¥è¦†ç›–å±‚borderå±æ€§ | border='1px solid #3b82f6' |

#### åœºæ™¯ 11: è¾¹ç•Œæƒ…å†µ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-IR-025 | é«˜åº¦ä¸º0æ—¶è°ƒæ•´ | img.height=0 | è°ƒæ•´ä¸å´©æºƒï¼Œå°ºå¯¸ä»å—æœ€å°å€¼é™åˆ¶ |

---

### 4.2 FloatingImageLayer.tsx

**æµ‹è¯•æ–‡ä»¶**: `components/editor/FloatingImageLayer.test.tsx`

#### åœºæ™¯ 1: åŸºç¡€æ¸²æŸ“

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-FI-001 | éç¼–è¾‘æ¨¡å¼å±•ç¤ºä½†ä¸å¯äº¤äº’ | isEditing=false | å›¾ç‰‡ä»æ¸²æŸ“ä½†ä¸å¯æ‹–æ‹½/ç¼©æ”¾ |
| TC-FI-002 | ä¸æ¸²æŸ“ï¼ˆæ— å›¾ç‰‡ï¼‰ | images=[] | containerä¸ºç©º |
| TC-FI-003 | æ­£å¸¸æ¸²æŸ“å¤šå¼ å›¾ç‰‡ | images=[{id:'1', x:10, y:20, ...}, ...] | æ˜¾ç¤ºæ‰€æœ‰å›¾ç‰‡å…ƒç´  |

#### åœºæ™¯ 2: å›¾ç‰‡é€‰æ‹©

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-FI-004 | ç‚¹å‡»é€‰ä¸­å›¾ç‰‡ | click on image element | onSelect(id)è¢«è°ƒç”¨ |
| TC-FI-005 | ç‚¹å‡»ç©ºç™½åŒºåŸŸå–æ¶ˆé€‰æ‹© | click on container(éå›¾ç‰‡åŒºåŸŸ) | onSelect(null)è¢«è°ƒç”¨ |
| TC-FI-006 | åªæ˜¾ç¤ºé€‰ä¸­å›¾ç‰‡çš„è°ƒæ•´æ‰‹æŸ„ | selectedId='img-1' | åªæœ‰img-1æ˜¾ç¤ºæ‰‹æŸ„ |

#### åœºæ™¯ 3: æ‹–æ‹½ç§»åŠ¨

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-FI-007 | å¼€å§‹æ‹–æ‹½ | pointerdown on image â†’ pointermove(50,30) | å›¾ç‰‡ä½ç½®è·Ÿéšç§»åŠ¨ |
| TC-FI-008 | æ‹–æ‹½è¾¹ç•Œé™åˆ¶ | æ‹–æ‹½åˆ°å®¹å™¨å¤– | å›¾ç‰‡ä¿ç•™åœ¨å®¹å™¨å†…æˆ–å…è®¸éƒ¨åˆ†è¶…å‡º |
| TC-FI-009 | ç»“æŸæ‹–æ‹½è°ƒç”¨onChange | pointerup | onChange(newImages)è¢«è°ƒç”¨ |
| TC-FI-010 | ç»“æŸæ‹–æ‹½è°ƒç”¨onCommit | pointerup | onCommit()è¢«è°ƒç”¨ |

#### åœºæ™¯ 4: è°ƒæ•´å¤§å°

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | åˆå§‹æ¡ä»¶ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|----------|------|----------|
| TC-FI-011 | æ‹–åŠ¨SEæ‰‹æŸ„è°ƒæ•´ | ä»»æ„ | pointerdown SE â†’ pointermove(50,50) | å®½åº¦å¢åŠ ~50pxï¼Œé«˜åº¦ç›¸åº”å¢åŠ  |
| TC-FI-012 | æ‹–åŠ¨Wæ‰‹æŸ„è°ƒæ•´ | ä»»æ„ | pointerdown W â†’ pointermove(-30,0) | å®½åº¦å¢åŠ 30pxï¼Œxä½ç½®å‡å°‘30px |
| TC-FI-013 | è§’è½æ‰‹æŸ„ä¿æŒå®½é«˜æ¯” | 240x160 (ratio=1.5) | æ‹–åŠ¨è§’è½æ‰‹æŸ„ï¼Œå®½åº¦å˜ä¸º300 | é«˜åº¦å˜ä¸º200 |
| TC-FI-024 | è°ƒæ•´ç»“æŸè°ƒç”¨onCommit | ä»»æ„ | pointerup on handle | onCommit()è¢«è°ƒç”¨ |

#### åœºæ™¯ 5: æ»šåŠ¨åŒæ­¥ä¸æŒ‡é’ˆç®¡ç†

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-FI-014 | æ»šåŠ¨æ—¶æ›´æ–°ä½ç½® | scrollOffset={x:0, y:100} | å›¾ç‰‡transformåŒ…å«translateY(-100) |
| TC-FI-015 | æ‹–æ‹½æ—¶setPointerCapture | pointerdown | è°ƒç”¨setPointerCapture |
| TC-FI-016 | é‡Šæ”¾æ—¶releasePointerCapture | pointerup | è°ƒç”¨releasePointerCapture |

#### åœºæ™¯ 6: æ€§èƒ½ä¼˜åŒ–

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-FI-017 | æ‹–æ‹½æ—¶ä½¿ç”¨RAFæ›´æ–° | å¿«é€Ÿè§¦å‘å¤šä¸ªpointermove | æœ€å¤šä¸€ä¸ªRAF pending |

#### åœºæ™¯ 7: é”®ç›˜æ“ä½œ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-FI-018 | Deleteåˆ é™¤é€‰ä¸­å›¾ç‰‡ | é€‰ä¸­å›¾ç‰‡ â†’ keydown('Delete') | onChange(åˆ é™¤åçš„images)è¢«è°ƒç”¨ |
| TC-FI-019 | Escapeå–æ¶ˆé€‰æ‹© | keydown('Escape') | onSelect(null)è¢«è°ƒç”¨ |

#### åœºæ™¯ 8: äº‹ä»¶å¤„ç†

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-FI-020 | æ‹–æ‹½å–æ¶ˆæ—¶æ¸…ç†çŠ¶æ€ | è§¦å‘pointerCancel | dragStateRefè¢«æ¸…ç©ºï¼Œè°ƒç”¨releasePointerCapture |

#### åœºæ™¯ 9: äº¤äº’çŠ¶æ€

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-FI-021 | éç¼–è¾‘æ¨¡å¼ä¸‹ä¸å“åº” | isEditing=falseæ—¶ç‚¹å‡»å›¾ç‰‡ | å›¾ç‰‡ä¸å“åº”ï¼ŒonSelectä¸è¢«è°ƒç”¨ |

#### åœºæ™¯ 10: è¾¹ç•Œæƒ…å†µ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-FI-022 | é›¶é«˜åº¦å›¾ç‰‡çš„ratioå¤„ç† (ğŸ”´é«˜é£é™©) | åˆ›å»ºheight=0çš„å›¾ç‰‡ | ratio=1ï¼Œä¸ä¼šé™¤ä»¥0å´©æºƒ |

#### åœºæ™¯ 11: æ ·å¼ç»†èŠ‚

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | éªŒè¯å†…å®¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-FI-023 | å›¾ç‰‡å…‰æ ‡æ ·å¼ | hover on image | cursor='move' |

---

### 4.3 useEditorCommands.ts

**æµ‹è¯•æ–‡ä»¶**: `components/editor/toolbar/hooks/useEditorCommands.test.ts`

#### åœºæ™¯ 1: åŸºç¡€å‘½ä»¤æ‰§è¡Œ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨å‘½ä»¤ | é¢„æœŸexecCommandè°ƒç”¨ |
|--------|--------|----------|-------------------|
| TC-EC-001 | åŠ ç²—å‘½ä»¤ | execute('bold') | execCommand('bold') |
| TC-EC-002 | æ–œä½“å‘½ä»¤ | execute('italic') | execCommand('italic') |
| TC-EC-003 | ä¸‹åˆ’çº¿å‘½ä»¤ | execute('underline') | execCommand('underline') |

#### åœºæ™¯ 2: æ–‡æœ¬æ ¼å¼åŒ–

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨å‘½ä»¤ | é¢„æœŸexecCommandè°ƒç”¨ |
|--------|--------|----------|-------------------|
| TC-EC-004 | è®¾ç½®å­—ä½“ | execute('fontName', 'Arial') | execCommand('fontName', false, 'Arial') |
| TC-EC-005 | è®¾ç½®å­—å· | execute('fontSize', '3') | execCommand('fontSize', false, '3') |
| TC-EC-006 | è®¾ç½®é¢œè‰² | execute('foreColor', '#ff0000') | execCommand('foreColor', false, '#ff0000') |

#### åœºæ™¯ 3: æ®µè½æ ¼å¼

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨å‘½ä»¤ | é¢„æœŸexecCommandè°ƒç”¨ |
|--------|--------|----------|-------------------|
| TC-EC-007 | è®¾ç½®æ ‡é¢˜ | execute('formatBlock', 'h2') | execCommand('formatBlock', false, 'h2') |
| TC-EC-008 | è®¾ç½®å¯¹é½æ–¹å¼ | execute('justifyCenter') | execCommand('justifyCenter') |
| TC-EC-009 | æ’å…¥åˆ—è¡¨ | execute('insertUnorderedList') | execCommand('insertUnorderedList') |

#### åœºæ™¯ 4: æ’å…¥æ“ä½œ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨æ–¹æ³• | å‚æ•° | é¢„æœŸç»“æœ |
|--------|--------|----------|------|----------|
| TC-EC-010 | æ’å…¥é“¾æ¥ | insertLink() | 'https://example.com' | execCommand('createLink', false, url) |
| TC-EC-011 | æ’å…¥å†…è”å›¾ç‰‡ | insertInlineImage() | 'data:image/jpeg;base64,...' | execCommand('insertImage', false, src) |
| TC-EC-012 | æ’å…¥è¡¨æ ¼ | insertTable() | rows=3, cols=4 | æ’å…¥3è¡Œ4åˆ—è¡¨æ ¼ |
| TC-EC-013 | æ’å…¥æ°´å¹³çº¿ | insertHorizontalRule() | - | execCommand('insertHorizontalRule') |

#### åœºæ™¯ 5: æ ¼å¼åˆ·åŠŸèƒ½

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EC-014 | æ¿€æ´»æ ¼å¼åˆ· | formatPainter() | æ•è·å½“å‰æ ·å¼ï¼ŒisFormatPainterActive=true |
| TC-EC-015 | åº”ç”¨æ ¼å¼åˆ· | æ¿€æ´»æ ¼å¼åˆ· â†’ é€‰æ‹©æ–°æ–‡æœ¬ | æ–°æ–‡æœ¬åº”ç”¨æ•è·çš„æ ·å¼ |
| TC-EC-016 | å–æ¶ˆæ ¼å¼åˆ· | å†æ¬¡è°ƒç”¨formatPainter() | isFormatPainterActive=false |

#### åœºæ™¯ 6: æ ·å¼æ•è·

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | é€‰æ‹©å†…å®¹ | é¢„æœŸæ•è·ç»“æœ |
|--------|--------|----------|-------------|
| TC-EC-017 | æ•è·ç²—ä½“çŠ¶æ€ | ç²—ä½“æ–‡æœ¬ | capturedStyles.bold = true |
| TC-EC-018 | æ•è·å­—ä½“ | Arialå­—ä½“æ–‡æœ¬ | capturedStyles.fontName = 'Arial' |
| TC-EC-019 | æ•è·é¢œè‰² | çº¢è‰²æ–‡æœ¬ | capturedStyles.color = '#ff0000' |

#### åœºæ™¯ 7: é€‰æ‹©ç®¡ç†

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨æ–¹æ³• | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-EC-020 | ä¿å­˜é€‰æ‹© | saveSelection() | é€‰æ‹©ä¿¡æ¯è¢«ä¿å­˜ |
| TC-EC-021 | æ¢å¤é€‰æ‹© | restoreSelection() | å…‰æ ‡ä½ç½®æ¢å¤åˆ°ä¿å­˜çš„ä½ç½® |

#### åœºæ™¯ 8: æ’¤é”€é‡åšä¸åˆ é™¤

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨æ–¹æ³• | é¢„æœŸexecCommandè°ƒç”¨ |
|--------|--------|----------|-------------------|
| TC-EC-022 | æ‰§è¡Œæ’¤é”€ | undo() | execCommand('undo') |
| TC-EC-023 | æ‰§è¡Œé‡åš | redo() | execCommand('redo') |
| TC-EC-024 | åˆ é™¤é€‰ä¸­å†…å®¹ | deleteSelection() | execCommand('delete') |

#### åœºæ™¯ 9: ç¼©è¿›æ“ä½œ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨å‘½ä»¤ | é¢„æœŸexecCommandè°ƒç”¨ |
|--------|--------|----------|-------------------|
| TC-EC-025 | å¢åŠ ç¼©è¿› | commands.indent() | execCommand('indent') |
| TC-EC-026 | å‡å°‘ç¼©è¿› | commands.outdent() | execCommand('outdent') |

#### åœºæ™¯ 10: æ¸…é™¤ä¸å–æ¶ˆæ“ä½œ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨å‘½ä»¤ | é¢„æœŸexecCommandè°ƒç”¨ |
|--------|--------|----------|-------------------|
| TC-EC-027 | å–æ¶ˆé“¾æ¥ | commands.unlink() | execCommand('unlink') |
| TC-EC-028 | æ¸…é™¤æ ¼å¼ | commands.removeFormat() | execCommand('removeFormat') |

#### åœºæ™¯ 11: é¢œè‰²è®¾ç½®

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨å‘½ä»¤ | å‚æ•° | é¢„æœŸç»“æœ |
|--------|--------|----------|------|----------|
| TC-EC-029 | è®¾ç½®èƒŒæ™¯è‰² | commands.hiliteColor() | '#ffff00' | execCommand('hiliteColor') æˆ– execCommand('backColor') |

#### åœºæ™¯ 12: è‡ªå®šä¹‰æ ·å¼

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨å‘½ä»¤ | å‚æ•° | é¢„æœŸç»“æœ |
|--------|--------|----------|------|----------|
| TC-EC-030 | è®¾ç½®å­—ä½“ç³»åˆ— | commands.fontFamily() | 'Arial' | applyCustomStyle('fontFamily', 'Arial') |
| TC-EC-031 | è®¾ç½®è¡Œé«˜ | commands.lineHeight() | '1.5' | æ‰¾åˆ°å—å…ƒç´ ï¼Œè®¾ç½®lineHeight='1.5' |

#### åœºæ™¯ 13: å·¥å…·å‡½æ•°æµ‹è¯•

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EC-034 | applyCustomStyle | applyCustomStyle('color', 'red') | è°ƒç”¨applyStyleï¼Œè§¦å‘onContentChange |
| TC-EC-035 | applyLineHeight | applyLineHeight(doc, '1.5') | æ‰¾åˆ°å—å…ƒç´ ï¼Œè®¾ç½®lineHeight |
| TC-EC-036 | é€‰æ‹©æ¢å¤å¤±è´¥å¤„ç† | mockæŠ›å‡ºå¼‚å¸¸ | å…‰æ ‡æ”¾åœ¨æ–‡æ¡£æœ«å°¾ |

#### åœºæ™¯ 14: æ ¼å¼åˆ·è‡ªåŠ¨åº”ç”¨ (ğŸ”´é«˜é£é™©)

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-EC-032 | æ ¼å¼åˆ·æ¿€æ´»åé€‰æ‹©æ–‡æœ¬è‡ªåŠ¨åº”ç”¨ | 1.æ¿€æ´»æ ¼å¼åˆ· 2.é€‰æ‹©æ–°æ–‡æœ¬ | æ ·å¼è‡ªåŠ¨åº”ç”¨ï¼Œæ ¼å¼åˆ·è‡ªåŠ¨å…³é—­ |
| TC-EC-033 | å–æ¶ˆæ ¼å¼åˆ·æ—¶æ¸…ç©ºä¿å­˜çš„æ ·å¼ | å†æ¬¡è°ƒç”¨formatPainter() | savedStylesRef.current = {} |
| TC-EC-037 | é€‰æ‹©æŠ˜å æ—¶ä¸è‡ªåŠ¨åº”ç”¨ | æ¿€æ´»æ ¼å¼åˆ· â†’ ç‚¹å‡»ä½†æœªé€‰ä¸­æ–‡æœ¬ | ä¸åº”ç”¨æ ·å¼ï¼Œæ ¼å¼åˆ·ä¿æŒæ¿€æ´» |

---

### 4.4 EditablePreview.tsx

**æµ‹è¯•æ–‡ä»¶**: `__tests__/components/editor/EditablePreview.test.tsx`

#### åœºæ™¯ 1: ç»„ä»¶æŒ‚è½½ä¸åˆå§‹åŒ–

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-EP-001 | ä¸é€‰æ‹©æ–‡ä»¶æ—¶ä¸æ˜¾ç¤ºç¼–è¾‘å™¨ | selectedFile=null | æ˜¾ç¤º"Please select an HTML file" |
| TC-EP-002 | é€‰æ‹©æ–‡ä»¶åæ˜¾ç¤ºiframe | selectedFile='resume.html', content='<p>test</p>' | iframeæ¸²æŸ“ï¼Œå†…å®¹æ­£ç¡®æ˜¾ç¤º |
| TC-EP-003 | åˆå§‹çŠ¶æ€ä¸ºéç¼–è¾‘æ¨¡å¼ | æ­£å¸¸æŒ‚è½½ | isEditing=false, "Enable Editing"æŒ‰é’®æ˜¾ç¤º |

#### åœºæ™¯ 2: ç¼–è¾‘æ¨¡å¼åˆ‡æ¢

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-004 | ç‚¹å‡»è¿›å…¥ç¼–è¾‘æ¨¡å¼ | click "Enable Editing" | isEditing=true, body contentEditable=true |
| TC-EP-005 | é€€å‡ºç¼–è¾‘æ¨¡å¼æ—¶åŒæ­¥å†…å®¹ | ç¼–è¾‘å†…å®¹ â†’ click "Lock Preview" | onContentChangeè¢«è°ƒç”¨ï¼ŒcontentEditable=false |

#### åœºæ™¯ 3: å†…å®¹ç¼–è¾‘

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-006 | è¾“å…¥æ–‡æœ¬è§¦å‘é˜²æŠ–åŒæ­¥ | åœ¨iframeä¸­è¾“å…¥æ–‡æœ¬ | 1ç§’åonContentChange(newHtml)è¢«è°ƒç”¨ |
| TC-EP-007 | å¤±ç„¦æ—¶ç«‹å³åŒæ­¥ | è¾“å…¥åblur iframe body | debouncedSync.flush()è¢«è°ƒç”¨ |

#### åœºæ™¯ 4: Enteré”®å¤„ç†

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-008 | Enteræ’å…¥<br>è€Œé<div> | æŒ‰Enteré”® | æ’å…¥<br>ï¼Œé»˜è®¤çš„<div>/<p>è¢«é˜»æ­¢ |

#### åœºæ™¯ 5: ç²˜è´´å›¾ç‰‡

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-009 | ç²˜è´´å›¾ç‰‡æˆåŠŸ | ç²˜è´´å›¾ç‰‡æ–‡ä»¶(<5MB) | å›¾ç‰‡è¢«æ’å…¥åˆ°å…‰æ ‡ä½ç½® |
| TC-EP-010 | ç²˜è´´è¶…å¤§å›¾ç‰‡è¢«æ‹’ç» | ç²˜è´´å›¾ç‰‡æ–‡ä»¶(>5MB) | æ˜¾ç¤ºalertï¼Œå›¾ç‰‡ä¸è¢«æ’å…¥ |

#### åœºæ™¯ 6: æ’¤é”€é‡åš

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-011 | Ctrl+Zè§¦å‘æ’¤é”€ | Ctrl+Z | undo()è¢«è°ƒç”¨ï¼Œå†…å®¹æ¢å¤åˆ°ä¸Šä¸€ä¸ªçŠ¶æ€ |
| TC-EP-012 | Ctrl+Shift+Zè§¦å‘é‡åš | Ctrl+Shift+Z | redo()è¢«è°ƒç”¨ |
| TC-EP-013 | æ’¤é”€æ—¶æ¸…ç©ºé€‰ä¸­çŠ¶æ€ | æœ‰é€‰ä¸­å›¾ç‰‡æ—¶æ’¤é”€ | selectedImage=null, selectedFloatingImageId=null |

#### åœºæ™¯ 7: å›¾ç‰‡é€‰æ‹©ä¸åˆ é™¤

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-014 | ç‚¹å‡»å›¾ç‰‡é€‰ä¸­ | click on <img> | selectedImageè¢«è®¾ç½®ï¼ŒImageResizeræ˜¾ç¤º |
| TC-EP-015 | Deleteåˆ é™¤é€‰ä¸­å›¾ç‰‡ | é€‰ä¸­å›¾ç‰‡ â†’ æŒ‰Delete | å›¾ç‰‡è¢«ç§»é™¤ï¼ŒselectedImage=null |

#### åœºæ™¯ 8: æµ®åŠ¨å›¾ç‰‡æ“ä½œ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-016 | æ’å…¥æµ®åŠ¨å›¾ç‰‡ | è°ƒç”¨onFloatingImageInsert | æ–°å›¾ç‰‡æ·»åŠ åˆ°floatingImagesæ•°ç»„ |
| TC-EP-017 | é€‰ä¸­æµ®åŠ¨å›¾ç‰‡åDeleteåˆ é™¤ | é€‰ä¸­æµ®åŠ¨å›¾ç‰‡ â†’ æŒ‰Delete | å›¾ç‰‡ä»floatingImagesä¸­ç§»é™¤ |

#### åœºæ™¯ 9: è¡¨æ ¼æ¿€æ´»ä¸å–æ¶ˆ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-018 | ç‚¹å‡»è¡¨æ ¼æ¿€æ´» | click on <table> | activeTableè¢«è®¾ç½®ï¼ŒTableSmartToolbaræ˜¾ç¤º |
| TC-EP-019 | ç‚¹å‡»è¡¨æ ¼å¤–éƒ¨å–æ¶ˆæ¿€æ´» | click on table â†’ click outside | activeTable=null |

#### åœºæ™¯ 10: è¡¨æ ¼æ“ä½œå‘½ä»¤

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è°ƒç”¨æ–¹æ³• | å‚æ•° | é¢„æœŸç»“æœ |
|--------|--------|----------|------|----------|
| TC-EP-020 | æ’å…¥è¡Œ | handleTableAction() | 'insertRowAfter', {index:1} | åœ¨ç¬¬1è¡Œåæ’å…¥æ–°è¡Œ |
| TC-EP-021 | æ’å…¥åˆ— | handleTableAction() | 'insertColumnAfter', {index:1} | åœ¨ç¬¬1åˆ—åæ’å…¥æ–°åˆ— |
| TC-EP-022 | åˆ é™¤è¡Œ | handleTableAction() | 'deleteRow', {index:0} | ç¬¬0è¡Œè¢«åˆ é™¤ |
| TC-EP-023 | åˆ é™¤åˆ— | handleTableAction() | 'deleteColumn', {index:0} | ç¬¬0åˆ—è¢«åˆ é™¤ |
| TC-EP-024 | åˆå¹¶å•å…ƒæ ¼ | handleTableAction() | 'mergeCells', {bounds:{...}} | å•å…ƒæ ¼è¢«åˆå¹¶ |
| TC-EP-025 | æ‹†åˆ†å•å…ƒæ ¼ | handleTableAction() | 'splitCell', {bounds:{...}} | å•å…ƒæ ¼è¢«æ‹†åˆ† |
| TC-EP-026 | åˆ é™¤è¡¨æ ¼ | handleTableAction() | 'deleteTable' | è¡¨æ ¼è¢«ç§»é™¤ï¼ŒactiveTable=null |
| TC-EP-042 | å‘ä¸Šæ’å…¥è¡Œ | handleTableAction() | 'insertRowBefore', {index:1} | åœ¨ç¬¬1è¡Œå‰æ’å…¥æ–°è¡Œ |
| TC-EP-043 | å‘å·¦æ’å…¥åˆ— | handleTableAction() | 'insertColumnBefore', {index:1} | åœ¨ç¬¬1åˆ—å‰æ’å…¥æ–°åˆ— |
| TC-EP-044 | å‚ç›´å¯¹é½é¡¶éƒ¨ | handleTableAction() | 'valignTop', {bounds:{...}} | é€‰ä¸­å•å…ƒæ ¼verticalAlign=top |
| TC-EP-045 | å‚ç›´å¯¹é½å±…ä¸­ | handleTableAction() | 'valignMiddle', {bounds:{...}} | é€‰ä¸­å•å…ƒæ ¼verticalAlign=middle |
| TC-EP-046 | å‚ç›´å¯¹é½åº•éƒ¨ | handleTableAction() | 'valignBottom', {bounds:{...}} | é€‰ä¸­å•å…ƒæ ¼verticalAlign=bottom |
| TC-EP-047 | è°ƒæ•´è¡Œé«˜ | handleTableAction() | 'resizeRow', {index:0, size:40} | ç¬¬0è¡Œé«˜åº¦å˜ä¸º40 |
| TC-EP-048 | è°ƒæ•´åˆ—å®½ | handleTableAction() | 'resizeColumn', {index:0, size:120} | ç¬¬0åˆ—å®½åº¦å˜ä¸º120 |

#### åœºæ™¯ 11: é€‰æ‹©ä¿å­˜ä¸æ¢å¤

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-027 | å†…å®¹æ›´æ–°å‰ä¿å­˜é€‰æ‹© | æœ‰å…‰æ ‡é€‰æ‹©æ—¶content propæ›´æ–° | é€‰æ‹©è·¯å¾„è¢«ä¿å­˜åˆ°selectionRef |
| TC-EP-028 | å†…å®¹æ›´æ–°åæ¢å¤é€‰æ‹© | contentæ›´æ–°å®Œæˆ | å…‰æ ‡æ¢å¤åˆ°ä¿å­˜çš„ä½ç½® |

#### åœºæ™¯ 12: iframeæ»šåŠ¨åŒæ­¥

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-029 | iframeæ»šåŠ¨æ—¶æ›´æ–°çŠ¶æ€ | scroll iframe | iframeScrollçŠ¶æ€æ›´æ–° |

#### åœºæ™¯ 13: æ¸…ç†HTML (getCleanHtml)

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥HTML | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-EP-030 | ç§»é™¤ç¼–è¾‘å™¨æ ‡è®° | åŒ…å«#image-resizer-root, #editor-styleçš„HTML | è¿™äº›å…ƒç´ è¢«ç§»é™¤ |
| TC-EP-031 | ç§»é™¤contenteditableå±æ€§ | å¸¦æœ‰contenteditableçš„HTML | æ‰€æœ‰contenteditableå±æ€§è¢«ç§»é™¤ |
| TC-EP-032 | ç§»é™¤ç©ºå— | åŒ…å«ç©ºçš„<p>, <div>çš„HTML | ç©ºå—è¢«ç§»é™¤ |
| TC-EP-049 | ä¿ç•™åŒ…å«åª’ä½“çš„å— | åŒ…å«<img>æˆ–<table>çš„ç©ºå— | å—å…ƒç´ ä¸è¢«ç§»é™¤ |

#### åœºæ™¯ 14: ç”ŸæˆçŠ¶æ€

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-EP-033 | ç”Ÿæˆä¸­æ˜¾ç¤ºè¦†ç›–å±‚ | isGenerating=true | æ˜¾ç¤º"Generating your resume..."æ¡ |

#### åœºæ™¯ 15: ç•Œé¢å…ƒç´ 

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-034 | Refreshé‡æ–°åŠ è½½ | click "Refresh" æŒ‰é’® | previewKeyå¢åŠ ï¼Œiframeé‡æ–°æ¸²æŸ“ |
| TC-EP-035 | ç”Ÿæˆä¸­æ˜¾ç¤ºè¿›åº¦æ¡ | isGenerating=true | æ˜¾ç¤ºè“è‰²è¿›åº¦æ¡å’Œ"Generating..."æ–‡æœ¬ |
| TC-EP-036 | ç¼–è¾‘æ¨¡å¼æ˜¾ç¤ºæç¤º | isEditing=true | æ˜¾ç¤º"âœï¸ Edit Mode Active"æç¤º |
| TC-EP-037 | æ˜¾ç¤ºç¼–è¾‘æŠ€å·§åº•éƒ¨æ¡ | isEditing=true | æ˜¾ç¤ºç¼–è¾‘æŠ€å·§æç¤ºæ–‡æœ¬ |

#### åœºæ™¯ 16: è¡¨æ ¼æ¿€æ´»ç»†èŠ‚

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-038 | å³é”®ç‚¹å‡»è¡¨æ ¼æ¿€æ´» | contextmenu on table | activeTableè¢«è®¾ç½® |
| TC-EP-039 | é€‰æ‹©å˜åŒ–æ—¶æ¿€æ´»è¡¨æ ¼ | æ”¹å˜å…‰æ ‡é€‰æ‹©åˆ°è¡¨æ ¼å†… | activeTableè¢«è®¾ç½® |

#### åœºæ™¯ 17: æµ®åŠ¨å›¾ç‰‡æ“ä½œç»†èŠ‚

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-EP-040 | æ‹–æ‹½ç»“æŸæäº¤å†å²è®°å½• | æ‹–æ‹½æµ®åŠ¨å›¾ç‰‡ç»“æŸ | onCommit()è¢«è°ƒç”¨ |
| TC-EP-041 | å›¾ç‰‡åŠ è½½å®Œæˆåæ›´æ–°å°ºå¯¸ | æ’å…¥æ–°å›¾ç‰‡ | å›¾ç‰‡å°ºå¯¸æ ¹æ®è‡ªç„¶å°ºå¯¸è°ƒæ•´ |

---

## äº”ã€å…¶ä»–ç»„ä»¶æµ‹è¯•ç”¨ä¾‹

### 5.1 TableSmartToolbar.tsx

**æ–‡ä»¶**: `components/editor/toolbar/TableSmartToolbar.tsx`
**è¡Œæ•°**: 686 è¡Œ
**å¤æ‚åº¦**: â­â­â­â­â­ (æœ€é«˜)
**æµ‹è¯•æ–‡ä»¶**: `components/editor/toolbar/TableSmartToolbar.test.tsx`

#### ç»„ä»¶æ¦‚è§ˆ

TableSmartToolbar æ˜¯ç¼–è¾‘å™¨ä¸­æœ€å¤æ‚çš„ç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£ï¼š
- è¡¨æ ¼åº¦é‡è®¡ç®— (è¡Œé«˜ã€åˆ—å®½)
- å•å…ƒæ ¼é€‰æ‹© (æ‹–æ‹½é€‰æ‹©åŒºåŸŸ)
- è¡Œ/åˆ—è°ƒæ•´å¤§å°
- å³é”®èœå•
- åˆå¹¶/æ‹†åˆ†å•å…ƒæ ¼
- æ’å…¥/åˆ é™¤è¡Œåˆ—

#### åœºæ™¯ 1: åŸºç¡€æ¸²æŸ“

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-TST-001 | ä¸æ¸²æŸ“ï¼ˆæ— activeTableï¼‰ | activeTable=null | è¿”å› null |
| TC-TST-002 | ä¸æ¸²æŸ“ï¼ˆreadonlyï¼‰ | readonly=true | è¿”å› null |
| TC-TST-003 | ä¸æ¸²æŸ“ï¼ˆæ— metricsï¼‰ | metrics=null | è¿”å› null |
| TC-TST-004 | æ­£å¸¸æ¸²æŸ“ | æ­£å¸¸æ¡ä»¶ | æ˜¾ç¤ºå®Œæ•´å·¥å…·æ  |

#### åœºæ™¯ 2: è¡¨æ ¼åº¦é‡è®¡ç®—

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | éªŒè¯å†…å®¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-TST-005 | è¡Œé«˜åº¦é‡è®¡ç®— | rowsæ•°ç»„ | æ¯è¡ŒåŒ…å« height, top, element |
| TC-TST-006 | åˆ—å®½åº¦é‡è®¡ç®— | colsæ•°ç»„ | æ¯åˆ—åŒ…å« width, left |
| TC-TST-007 | è¡¨æ ¼ä½ç½®è®¡ç®— | tableTop, tableLeft | æ­£ç¡®è®¡ç®—è¡¨æ ¼ä½ç½® |
| TC-TST-008 | è¡¨æ ¼å°ºå¯¸è®¡ç®— | tableWidth, tableHeight | æ­£ç¡®è®¡ç®—å®½é«˜ |

#### åœºæ™¯ 3: åº¦é‡æ›´æ–° (useEffect)

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è§¦å‘æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-TST-009 | activeTableå˜åŒ–æ—¶æ›´æ–° | activeTable prop å˜åŒ– | updateMetrics è¢«è°ƒç”¨ |
| TC-TST-010 | iframeæ»šåŠ¨æ—¶æ›´æ–° | è§¦å‘scrolläº‹ä»¶ | metrics æ›´æ–°ï¼ŒcontextMenu å…³é—­ |
| TC-TST-011 | MutationObserverç›‘å¬ | DOMç»“æ„å˜åŒ– | metrics æ›´æ–° |
| TC-TST-012 | æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ | ç»„ä»¶å¸è½½ | æ‰€æœ‰ç›‘å¬å™¨è¢«ç§»é™¤ |

#### åœºæ™¯ 4: å•å…ƒæ ¼é€‰æ‹© (æ‹–æ‹½)

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-TST-013 | ç‚¹å‡»å•å…ƒæ ¼é€‰æ‹© | mousedown on cell | selection è¢«è®¾ç½®ï¼ŒisSelecting=true |
| TC-TST-014 | æ‹–æ‹½æ‰©å±•é€‰æ‹© | æŒ‰ä½é¼ æ ‡æ‹–åŠ¨ | selection åŒºåŸŸè·Ÿéšæ‰©å±• |
| TC-TST-015 | å¤šå•å…ƒæ ¼é€‰æ‹© | æ‹–æ‹½è¦†ç›–å¤šä¸ªå•å…ƒæ ¼ | selection æ­£ç¡®è¦†ç›–æ‰€æœ‰å•å…ƒæ ¼ |
| TC-TST-016 | ç‚¹å‡»å¤–éƒ¨å–æ¶ˆé€‰æ‹© | click outside | selection=null |
| TC-TST-017 | é€‰æ‹©åŒºåŸŸæ ·å¼ | æœ‰selectionæ—¶ | æ˜¾ç¤ºè“è‰²è¦†ç›–å±‚ |

#### åœºæ™¯ 5: è¡Œ/åˆ—è°ƒæ•´å¤§å°

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-TST-018 | æ˜¾ç¤ºè°ƒæ•´æç¤º | hoveråœ¨è¡Œ/åˆ—è¾¹ç¼˜ | resizeHintè¢«è®¾ç½® |
| TC-TST-019 | å¼€å§‹è°ƒæ•´å¤§å° | mousedown on resizeHint | isResizing=true |
| TC-TST-020 | æ‹–åŠ¨è°ƒæ•´è¡Œé«˜ | æ‹–åŠ¨è¡Œè°ƒæ•´çº¿ | è¡Œé«˜è·Ÿéšå˜åŒ– |
| TC-TST-021 | æ‹–åŠ¨è°ƒæ•´åˆ—å®½ | æ‹–åŠ¨åˆ—è°ƒæ•´çº¿ | åˆ—å®½è·Ÿéšå˜åŒ– |
| TC-TST-022 | ç»“æŸè°ƒæ•´ | mouseup | onAction('resizeRow'/'resizeColumn')è¢«è°ƒç”¨ |

#### åœºæ™¯ 6: è°ƒæ•´æç¤ºæ£€æµ‹

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | é¼ æ ‡ä½ç½® | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-TST-023 | æ£€æµ‹è¡Œè°ƒæ•´è¾¹ç¼˜ | é¼ æ ‡åœ¨è¡Œè¾¹ç¼˜(Â±4px) | resizeHint.type='row' |
| TC-TST-024 | æ£€æµ‹åˆ—è°ƒæ•´è¾¹ç¼˜ | é¼ æ ‡åœ¨åˆ—è¾¹ç¼˜(Â±4px) | resizeHint.type='col' |
| TC-TST-025 | è¶…å‡ºé˜ˆå€¼ä¸æ˜¾ç¤º | é¼ æ ‡è¿œç¦»è¾¹ç¼˜ | resizeHint=null |
| TC-TST-026 | å…‰æ ‡æ ·å¼è·Ÿéš | æ˜¾ç¤ºresizeHintæ—¶ | cursor='row-resize'æˆ–'col-resize' |

#### åœºæ™¯ 7: è¡Œ/åˆ—æŒ‡ç¤ºå™¨

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | éªŒè¯å†…å®¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-TST-027 | åˆ—æŒ‡ç¤ºå™¨æ¸²æŸ“ | é¡¶éƒ¨æ˜¾ç¤ºåˆ—æ¡ | æ¯åˆ—æœ‰ä¸€ä¸ªæŒ‡ç¤ºå™¨ |
| TC-TST-028 | è¡ŒæŒ‡ç¤ºå™¨æ¸²æŸ“ | å·¦ä¾§æ˜¾ç¤ºè¡Œæ¡ | æ¯è¡Œæœ‰ä¸€ä¸ªæŒ‡ç¤ºå™¨ |
| TC-TST-029 | ç‚¹å‡»åˆ—æŒ‡ç¤ºå™¨é€‰ä¸­åˆ— | click on col indicator | é€‰ä¸­æ•´åˆ— |
| TC-TST-030 | ç‚¹å‡»è¡ŒæŒ‡ç¤ºå™¨é€‰ä¸­è¡Œ | click on row indicator | é€‰ä¸­æ•´è¡Œ |
| TC-TST-031 | hoveræ•ˆæœ | hover on indicator | æ˜¾ç¤ºè“è‰²é«˜äº® |
| TC-TST-032 | +æŒ‰é’®æ˜¾ç¤º | æ¯ä¸ªæŒ‡ç¤ºå™¨æœ‰+æŒ‰é’® | ç‚¹å‡»æ’å…¥è¡Œåˆ— |
| TC-TST-033 | +æŒ‰é’®é˜»æ­¢å†’æ³¡ | click on +æŒ‰é’® | ä¸è§¦å‘çˆ¶å…ƒç´ äº‹ä»¶ |

#### åœºæ™¯ 8: å³é”®èœå•

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-TST-034 | å³é”®æ˜¾ç¤ºèœå• | contextmenu on cell | SmartContextMenu æ˜¾ç¤º |
| TC-TST-035 | èœå•ä½ç½®æ­£ç¡® | menuX, menuY | èœå•åœ¨é¼ æ ‡ä½ç½® |
| TC-TST-036 | ç‚¹å‡»å¤–éƒ¨å…³é—­èœå• | click outside | èœå•å…³é—­ |
| TC-TST-037 | æ»šåŠ¨æ—¶å…³é—­èœå• | scroll iframe | èœå•å…³é—­ |

#### åœºæ™¯ 9: åˆå¹¶ä¸æ‹†åˆ†

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-TST-038 | é€‰ä¸­å¤šä¸ªå•å…ƒæ ¼å¯åˆå¹¶ | selectionè¦†ç›–å¤šä¸ªæœªåˆå¹¶å•å…ƒæ ¼ | canMerge=true |
| TC-TST-039 | é€‰ä¸­å•ä¸ªåˆå¹¶å•å…ƒæ ¼å¯æ‹†åˆ† | selectionä¸ºå•ä¸ªåˆå¹¶å•å…ƒæ ¼ | canSplit=true |
| TC-TST-040 | åˆå¹¶åä¸å¯å†åˆå¹¶ | å·²åˆå¹¶çš„å•å…ƒæ ¼ | canMerge=false |
| TC-TST-041 | æ‹†åˆ†åä¸å¯å†æ‹†åˆ† | å·²æ‹†åˆ†çš„å•å…ƒæ ¼ | canSplit=false |

#### åœºæ™¯ 10: è§’è½å—å…¨é€‰

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-TST-042 | ç‚¹å‡»è§’è½å— | click on corner block | é€‰ä¸­æ•´ä¸ªè¡¨æ ¼ |

#### åœºæ™¯ 11: Portal æ¸²æŸ“

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | éªŒè¯å†…å®¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-TST-043 | SmartContextMenué€šè¿‡Portalæ¸²æŸ“ | æ£€æŸ¥DOMç»“æ„ | èœå•æ¸²æŸ“åœ¨document.bodyä¸­ |
| TC-TST-044 | Portalèœå•z-indexæœ€é«˜ | æ£€æŸ¥z-index | z-index=9999 |

#### åœºæ™¯ 12: è¾¹ç•Œæƒ…å†µ

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | è¾“å…¥æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|----------|----------|
| TC-TST-045 | ç©ºè¡¨æ ¼ | 0è¡Œ0åˆ— | æŒ‡ç¤ºå™¨ä¸ºç©ºæ•°ç»„ |
| TC-TST-046 | è¶…å¤§è¡¨æ ¼ | 100x100 | ä»ç„¶æ­£å¸¸å·¥ä½œ |
| TC-TST-047 | è¡¨æ ¼åœ¨iframeå¤– | activeTableä¸åœ¨iframeå†… | metricsæ›´æ–°å¤±è´¥ï¼Œè¿”å›null |

---

### 5.2 SmartContextMenu.tsx

**æ–‡ä»¶**: `components/editor/toolbar/SmartContextMenu.tsx`
**è¡Œæ•°**: 153 è¡Œ
**å¤æ‚åº¦**: â­â­â­
**æµ‹è¯•æ–‡ä»¶**: `components/editor/toolbar/SmartContextMenu.test.tsx`

#### åœºæ™¯ 1: åŸºç¡€æ¸²æŸ“

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|
| TC-SCM-001 | æ­£å¸¸æ¸²æŸ“èœå• | æ˜¾ç¤ºå›ºå®šå®šä½çš„èœå•å®¹å™¨ |
| TC-SCM-002 | èœå•ä½ç½®æ­£ç¡® | top=position.y, left=position.x |

#### åœºæ™¯ 2: ç‚¹å‡»å¤–éƒ¨å…³é—­

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-SCM-003 | ç‚¹å‡»å¤–éƒ¨å…³é—­ | click outside menu | onClose()è¢«è°ƒç”¨ |
| TC-SCM-004 | èœå•é¡¹ç‚¹å‡»å…³é—­ | click on menu item | onClose()è¢«è°ƒç”¨ |

#### åœºæ™¯ 3: å‚ç›´å¯¹é½å­èœå•

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-SCM-005 | hoveræ˜¾ç¤ºå­èœå• | mouseenter on "Vertical Align" | å­èœå•æ˜¾ç¤º |
| TC-SCM-006 | leaveéšè—å­èœå• | mouseleave from "Vertical Align" | å­èœå•éšè— |
| TC-SCM-007 | Align Topç‚¹å‡» | click "Align Top" | handleAction('valignTop'), onClose |
| TC-SCM-008 | Align Middleç‚¹å‡» | click "Align Middle" | handleAction('valignMiddle'), onClose |
| TC-SCM-009 | Align Bottomç‚¹å‡» | click "Align Bottom" | handleAction('valignBottom'), onClose |

#### åœºæ™¯ 4: æ’å…¥å­èœå•

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-SCM-010 | Insert Row Above | click "Insert Row Above" | handleAction('insertRowBefore'), onClose |
| TC-SCM-011 | Insert Row Below | click "Insert Row Below" | handleAction('insertRowAfter'), onClose |
| TC-SCM-012 | Insert Column Left | click "Insert Column Left" | handleAction('insertColumnBefore'), onClose |
| TC-SCM-013 | Insert Column Right | click "Insert Column Right" | handleAction('insertColumnAfter'), onClose |

#### åœºæ™¯ 5: åˆ é™¤å­èœå•

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-SCM-014 | Delete Row | click "Delete Row" | handleAction('deleteRow'), onClose |
| TC-SCM-015 | Delete Column | click "Delete Column" | handleAction('deleteColumn'), onClose |
| TC-SCM-016 | Delete Table | click "Delete Table" | handleAction('deleteTable'), onClose |
| TC-SCM-017 | åˆ é™¤é¡¹çº¢è‰²æ ·å¼ | æ£€æŸ¥åˆ é™¤èœå•é¡¹ | classNameåŒ…å« 'text-red-600' |

#### åœºæ™¯ 6: åˆå¹¶ä¸æ‹†åˆ†

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ¡ä»¶ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-SCM-018 | æ˜¾ç¤ºMerge Cells | canMerge=true | æ˜¾ç¤ºèœå•é¡¹ |
| TC-SCM-019 | ä¸æ˜¾ç¤ºMerge Cells | canMerge=false | ä¸æ˜¾ç¤ºèœå•é¡¹ |
| TC-SCM-020 | ç‚¹å‡»Merge Cells | click | handleAction('mergeCells'), onClose |
| TC-SCM-021 | æ˜¾ç¤ºSplit Cell | canSplit=true | æ˜¾ç¤ºèœå•é¡¹ |
| TC-SCM-022 | ä¸æ˜¾ç¤ºSplit Cell | canSplit=false | ä¸æ˜¾ç¤ºèœå•é¡¹ |
| TC-SCM-023 | ç‚¹å‡»Split Cell | click | handleAction('splitCell'), onClose |

#### åœºæ™¯ 7: èœå•é¡¹é˜»æ­¢å³é”®

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-SCM-024 | èœå•é˜»æ­¢contextmenu | è§¦å‘contextmenu on menu | e.preventDefault()è¢«è°ƒç”¨ |

---

### 5.3 Pickers ç»„ä»¶

#### 5.3.1 TablePicker.tsx (119 è¡Œ)

**æµ‹è¯•æ–‡ä»¶**: `components/editor/toolbar/pickers/TablePicker.test.tsx`

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|
| TC-TP-001 | æ˜¾ç¤ºè¡¨æ ¼é¢„è§ˆ | æ˜¾ç¤ºå¯äº¤äº’çš„è¡¨æ ¼ç½‘æ ¼ |
| TC-TP-002 | hoveré«˜äº®å•å…ƒæ ¼ | hover on cell | å•å…ƒæ ¼é«˜äº® |
| TC-TP-003 | ç‚¹å‡»ç¡®è®¤é€‰æ‹© | click on cell | onConfirmè¢«è°ƒç”¨ï¼Œä¼ é€’è¡Œåˆ—æ•° |
| TC-TP-004 | ç‚¹å‡»å¤–éƒ¨å…³é—­ | click outside | onCloseè¢«è°ƒç”¨ |

#### 5.3.2 ImagePicker.tsx (102 è¡Œ)

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|
| TC-IP-001 | æ˜¾ç¤ºå›¾ç‰‡é€‰é¡¹ | æ˜¾ç¤ºé¢„è®¾å›¾ç‰‡åˆ—è¡¨ |
| TC-IP-002 | hoveræ˜¾ç¤ºé¢„è§ˆ | hover on image | æ˜¾ç¤ºå¤§å›¾é¢„è§ˆ |
| TC-IP-003 | ç‚¹å‡»ç¡®è®¤é€‰æ‹© | click on image | onConfirmè¢«è°ƒç”¨ |

#### 5.3.3 ColorPicker.tsx (147 è¡Œ)

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|
| TC-CP-001 | æ˜¾ç¤ºé¢œè‰²ç½‘æ ¼ | æ˜¾ç¤ºé¢„è®¾é¢œè‰² |
| TC-CP-002 | ç‚¹å‡»é¢œè‰²é€‰æ‹© | click on color | onChangeè¢«è°ƒç”¨ |

#### 5.3.4 ColorGrid.tsx (60 è¡Œ)

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|
| TC-CG-001 | æ¸²æŸ“é¢œè‰²å— | æ˜¾ç¤ºé¢œè‰²æ–¹å— |
| TC-CG-002 | hoveré«˜äº®æ•ˆæœ | hover on color block | è¾¹æ¡†åŠ ç²— |

---

### 5.4 Inputs ç»„ä»¶

#### 5.4.1 ToolbarSelect.tsx (73 è¡Œ)

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | é¢„æœŸç»“æœ |
|--------|--------|----------|
| TC-TS-001 | æ˜¾ç¤ºé€‰æ‹©å™¨ | æ˜¾ç¤ºä¸‹æ‹‰é€‰é¡¹ |
| TC-TS-002 | é€‰é¡¹é€‰ä¸­çŠ¶æ€ | æŸä¸ªé€‰é¡¹è¢«é€‰ä¸­æ—¶ | æ˜¾ç¤ºé«˜äº® |

---

## å…­ã€Mock ç­–ç•¥

### 6.1 å…¨å±€ Mock é…ç½®

| API | Mock å†…å®¹ | ç”¨é€” |
|-----|-----------|------|
| ResizeObserver | observe/unobserve/disconnect å‡½æ•° | å›¾ç‰‡è°ƒæ•´ç»„ä»¶æµ‹è¯• |
| getBoundingClientRect | è¿”å› {width, height, top, left, ...} | å…ƒç´ ä½ç½®è®¡ç®— |
| setPointerCapture | å‡½æ•° | FloatingImageLayer æµ‹è¯• |
| releasePointerCapture | å‡½æ•° | FloatingImageLayer æµ‹è¯• |
| window.prompt | è¿”å›URLå­—ç¬¦ä¸² | useEditorCommands.createLink |
| MutationObserver | observe/disconnect | TableSmartToolbar æµ‹è¯• |
| queryCommandSupported | è¿”å›å¸ƒå°”å€¼ | hiliteColor å…¼å®¹æ€§ |

### 6.2 æµ‹è¯•å·¥å…·å‡½æ•°

| å‡½æ•°å | åŠŸèƒ½ | è¿”å›å€¼ |
|--------|------|--------|
| createMockIframe() | åˆ›å»ºæ¨¡æ‹Ÿiframe | {iframe, doc} |
| createMockImage(options) | åˆ›å»ºæ¨¡æ‹Ÿå›¾ç‰‡å…ƒç´  | HTMLImageElement |
| createMockTable(rows, cols) | åˆ›å»ºæ¨¡æ‹Ÿè¡¨æ ¼ | HTMLTableElement |
| createMockCell(row, col) | åˆ›å»ºæ¨¡æ‹Ÿå•å…ƒæ ¼ | HTMLTableCellElement |
| createMockSelection() | åˆ›å»ºæ¨¡æ‹Ÿé€‰æ‹©å¯¹è±¡ | Selection |
| simulatePointerEvents(element, events) | æ¨¡æ‹ŸæŒ‡é’ˆäº‹ä»¶ | void |
| simulateDrag(element, events) | æ¨¡æ‹Ÿæ‹–æ‹½äº‹ä»¶ | void |
| simulateKeyboard() | æ¨¡æ‹Ÿé”®ç›˜äº‹ä»¶ | void |
| waitForRAF() | ç­‰å¾…RAFå®Œæˆ | Promise |
| waitForMutationObserver() | ç­‰å¾…MOå®Œæˆ | Promise |
| getTableMetrics(table) | è·å–è¡¨æ ¼åº¦é‡ | TableMetrics |
| createMockResizeObserver() | åˆ›å»ºæ¨¡æ‹ŸROå®ä¾‹ | ResizeObserver |

---

## ä¸ƒã€æµ‹è¯•æ‰§è¡Œè®¡åˆ’

### 7.1 é˜¶æ®µåˆ’åˆ†

| é˜¶æ®µ | ç»„ä»¶ | ç”¨ä¾‹æ•° | é¢„è®¡æ—¶é—´ |
|------|------|--------|----------|
| ä¸€ | ImageResizer + é«˜é£é™©ç”¨ä¾‹ | 27 | 3h |
| ä¸€ | SmartContextMenu | 18 | 3h |
| äºŒ | FloatingImageLayer | 23 | 4h |
| äºŒ | useEditorCommands | 35 | 5h |
| äºŒ | TableSmartToolbar | 45 | 8h |
| ä¸‰ | EditablePreview | 41 | 7h |
| å›› | pickers/inputs | 14 | 2h |
| å›› | é›†æˆæµ‹è¯• | 10-15 | 4h |
| - | æµ‹è¯•ä¿®å¤ä¸å®Œå–„ | - | 4h |
| **æ€»è®¡** | **11ç»„ä»¶** | **209** | **38-42å°æ—¶** |

### 7.2 è¯¦ç»†å®æ–½é¡ºåº

```
ç¬¬ä¸€é˜¶æ®µ: åŸºç¡€ç»„ä»¶ + é«˜é£é™©ç”¨ä¾‹ (6å°æ—¶)
â”œâ”€â”€ ImageResizer (25ç”¨ä¾‹) - 3h
â””â”€â”€ é«˜é£é™©ç”¨ä¾‹è¡¥å…… (2ç”¨ä¾‹) - 0.5h

ç¬¬äºŒé˜¶æ®µ: æ ¸å¿ƒäº¤äº’ç»„ä»¶ (20å°æ—¶)
â”œâ”€â”€ SmartContextMenu (18ç”¨ä¾‹) - 3h
â”œâ”€â”€ FloatingImageLayer (24ç”¨ä¾‹) - 4h
â”œâ”€â”€ useEditorCommands (35ç”¨ä¾‹) - 5h
â””â”€â”€ TableSmartToolbar (45ç”¨ä¾‹) â† æœ€å¤æ‚ - 8h

ç¬¬ä¸‰é˜¶æ®µ: ä¸»å®¹å™¨é›†æˆ (11å°æ—¶)
â”œâ”€â”€ EditablePreview (41ç”¨ä¾‹) - 7h
â””â”€â”€ é›†æˆæµ‹è¯• (10-15ç”¨ä¾‹) - 4h

ç¬¬å››é˜¶æ®µ: å·¥å…·æ ç»„ä»¶ (6å°æ—¶)
â”œâ”€â”€ TablePicker, ImagePicker, ColorPicker (9ç”¨ä¾‹) - 1.5h
â”œâ”€â”€ ToolbarSelect, ColorGrid (4ç”¨ä¾‹) - 0.5h
â””â”€â”€ æµ‹è¯•ä¿®å¤ä¸å®Œå–„ - 4h
```

---

## å…«ã€æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

| ç»„ä»¶ | è¯­å¥è¦†ç›– | åˆ†æ”¯è¦†ç›– | å‡½æ•°è¦†ç›– | è¡Œè¦†ç›– |
|------|---------|---------|---------|--------|
| ImageResizer | >85% | >80% | >90% | >85% |
| FloatingImageLayer | >80% | >75% | >85% | >80% |
| useEditorCommands | >85% | >80% | >90% | >85% |
| EditablePreview | >75% | >70% | >80% | >75% |
| TableSmartToolbar | >75% | >70% | >80% | >75% |
| SmartContextMenu | >80% | >75% | >85% | >80% |
| Pickers/Inputs | >70% | >65% | >75% | >70% |

---

## ä¹ã€æµ‹è¯•å‘½ä»¤

| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| `npm test` | è¿è¡Œæ‰€æœ‰æµ‹è¯• |
| `npm test ImageResizer.test.tsx` | è¿è¡Œç‰¹å®šæ–‡ä»¶ |
| `npm test -- --watch` | ç›‘è§†æ¨¡å¼ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰ |
| `npm test -- --coverage` | ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š |
| `npm test -- --onlyFailures` | åªè¿è¡Œæœªé€šè¿‡çš„æµ‹è¯• |
| `npm test -- -u` | æ›´æ–°å¿«ç…§ |

---

## åã€é‡æ„æ—¶çš„æµ‹è¯•æµç¨‹

| æ­¥éª¤ | æ“ä½œ | éªŒè¯ |
|------|------|------|
| 1 | é‡æ„å‰è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |
| 2 | è¿›è¡Œä¸€ä¸ªå°çš„é‡æ„æ”¹åŠ¨ | åªæ”¹åŠ¨ä¸€å¤„ |
| 3 | è¿è¡Œå—å½±å“çš„æµ‹è¯• | å¦‚æœå¤±è´¥ï¼šä¿®å¤ä»£ç æˆ–æ›´æ–°æµ‹è¯• |
| 4 | æµ‹è¯•é€šè¿‡åæäº¤ | ç»§ç»­ä¸‹ä¸€æ­¥ |
| 5 | æ¯å¤©ç»“æŸæ—¶è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ | æ£€æŸ¥è¦†ç›–ç‡ã€æ‰‹åŠ¨éªŒè¯å…³é”®åŠŸèƒ½ |
| 6 | å®Œæˆé‡æ„ååˆ›å»ºåŸºçº¿å¿«ç…§ | æœ€ç»ˆæµ‹è¯•è¿è¡Œã€è¦†ç›–ç‡æŠ¥å‘Š |

---

## åä¸€ã€é£é™©ä¸åº”å¯¹

| é£é™© | åº”å¯¹æªæ–½ |
|------|---------|
| iframeæµ‹è¯•å›°éš¾ | åˆ›å»ºä¸“é—¨çš„iframe Mockå·¥å…· |
| DOMäº¤äº’å¤æ‚ | ä½¿ç”¨Testing Libraryçš„userEvent |
| å¼‚æ­¥æ—¶åºé—®é¢˜ | ä½¿ç”¨waitFor + actåŒ…è£… |
| æ‹–æ‹½äº‹ä»¶éš¾ä»¥æ¨¡æ‹Ÿ | åˆ›å»ºsimulatePointerEventså·¥å…·å‡½æ•° |
| ResizeObserver | å…¨å±€Mock |
| MutationObserver | å…¨å±€Mock |
| æµ‹è¯•è¿è¡Œç¼“æ…¢ | ä½¿ç”¨mocké¿å…çœŸå®DOMæ“ä½œ |

---

## åäºŒã€é›†æˆæµ‹è¯•å»ºè®®

é™¤äº†ç»„ä»¶çº§å•å…ƒæµ‹è¯•ï¼Œå»ºè®®æ·»åŠ é›†æˆæµ‹è¯•ï¼š

| é›†æˆæµ‹è¯• | æµ‹è¯•å†…å®¹ |
|---------|----------|
| IT-001 | å®Œæ•´çš„ç¼–è¾‘æµç¨‹ï¼ˆç¼–è¾‘â†’ä¿å­˜â†’åˆ·æ–°ï¼‰ |
| IT-002 | è¡¨æ ¼å®Œæ•´æ“ä½œï¼ˆæ’å…¥â†’ç¼–è¾‘â†’åˆ é™¤ï¼‰ |
| IT-003 | æµ®åŠ¨å›¾ç‰‡å®Œæ•´æ“ä½œï¼ˆæ’å…¥â†’æ‹–æ‹½â†’è°ƒæ•´â†’åˆ é™¤ï¼‰ |
| IT-004 | æ ¼å¼åˆ·å®Œæ•´æµç¨‹ï¼ˆæ•è·â†’åº”ç”¨ï¼‰ |
| IT-005 | æ’¤é”€é‡åšå®Œæ•´æµç¨‹ |

---

## åä¸‰ã€è¾¹ç•Œæƒ…å†µæµ‹è¯•å»ºè®®

| è¾¹ç•Œæƒ…å†µ | æµ‹è¯•åœºæ™¯ |
|---------|----------|
| æå°å›¾ç‰‡å°ºå¯¸ | 1x1 px çš„å›¾ç‰‡ |
| æå¤§å›¾ç‰‡å°ºå¯¸ | 5000x5000 px çš„å›¾ç‰‡ |
| ç©ºå†…å®¹ | content='' |
| ç‰¹æ®Šå­—ç¬¦ | åŒ…å« HTML ç‰¹æ®Šå­—ç¬¦çš„å†…å®¹ |
| å¿«é€Ÿè¿ç»­æ“ä½œ | å¿«é€Ÿç‚¹å‡»ã€å¿«é€Ÿæ‹–æ‹½ |
| å†…å­˜é™åˆ¶ | å¤§é‡æµ®åŠ¨å›¾ç‰‡ï¼ˆ>100å¼ ï¼‰ |

---

## åå››ã€æˆåŠŸæ ‡å‡†

- [ ] æ‰€æœ‰æ–°å¢æµ‹è¯•é€šè¿‡
- [ ] è¦†ç›–ç‡è¾¾åˆ°ç›®æ ‡
- [ ] ç°æœ‰æµ‹è¯•ä»ç„¶é€šè¿‡
- [ ] æµ‹è¯•è¿è¡Œæ—¶é—´ <45 ç§’
- [ ] æ‰‹åŠ¨éªŒè¯æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
- [ ] é«˜é£é™©ç”¨ä¾‹ 100% è¦†ç›–

---

## åäº”ã€æ€§èƒ½æµ‹è¯•ç”¨ä¾‹

### 15.1 æ¸²æŸ“æ€§èƒ½

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-PERF-001 | å¤§é‡æ–‡æœ¬æ¸²æŸ“ | æ¸²æŸ“åŒ…å«10000ä¸ªæ®µè½çš„æ–‡æ¡£ | æ¸²æŸ“æ—¶é—´ <500ms |
| TC-PERF-002 | å¤§é‡æµ®åŠ¨å›¾ç‰‡ | åŒæ—¶æ¸²æŸ“50å¼ æµ®åŠ¨å›¾ç‰‡ | æ¸²æŸ“æ—¶é—´ <1000ms |
| TC-PERF-003 | å¤æ‚è¡¨æ ¼æ¸²æŸ“ | æ¸²æŸ“20x20çš„è¡¨æ ¼ | æ¸²æŸ“æ—¶é—´ <300ms |

### 15.2 äº¤äº’æ€§èƒ½

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-PERF-004 | å¿«é€Ÿæ‹–æ‹½ | å¿«é€Ÿè¿ç»­æ‹–æ‹½å›¾ç‰‡100æ¬¡ | æ— å¡é¡¿ï¼Œå¸§ç‡ >30fps |
| TC-PERF-005 | å¿«é€Ÿæ ¼å¼åŒ– | è¿ç»­åº”ç”¨æ ¼å¼50æ¬¡ | å“åº”æ—¶é—´ <100ms |
| TC-PERF-006 | å¤§é‡æ’¤é”€é‡åš | æ‰§è¡Œ100æ¬¡æ’¤é”€/é‡åš | æ— æ˜æ˜¾å»¶è¿Ÿ |

### 15.3 å†…å­˜æ€§èƒ½

| ç”¨ä¾‹ID | æµ‹è¯•é¡¹ | æ“ä½œ | é¢„æœŸç»“æœ |
|--------|--------|------|----------|
| TC-PERF-007 | å†…å­˜æ³„æ¼æ£€æµ‹ | æ’å…¥å’Œåˆ é™¤å›¾ç‰‡100æ¬¡ | å†…å­˜å¢é•¿ <50MB |
| TC-PERF-008 | äº‹ä»¶ç›‘å¬å™¨æ¸…ç† | é¢‘ç¹åˆ‡æ¢ç¼–è¾‘æ¨¡å¼ | æ— ç›‘å¬å™¨æ³„æ¼ |
| TC-PERF-009 | å¤§æ–‡æ¡£å†…å­˜å ç”¨ | ç¼–è¾‘10000å­—çš„æ–‡æ¡£ | å†…å­˜ä½¿ç”¨ <200MB |

---

## åå…­ã€æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥æ¸…å•

- [ ] TEST_PLAN.mdä¸TEST_IMPLEMENTATION_PLAN.mdçš„ç”¨ä¾‹æ€»æ•°ä¸€è‡´
- [ ] EditablePreviewç”¨ä¾‹æ•°å·²ä¿®æ­£ä¸º41
- [ ] useEditorCommandsç”¨ä¾‹æ•°å·²ä¿®æ­£ä¸º35ï¼ˆå®é™…æœ‰37ä¸ªç”¨ä¾‹ï¼Œå£°æ˜35ä¸ªï¼‰
- [ ] æ€»ç”¨ä¾‹æ•°å·²ä¿®æ­£ä¸º209
- [ ] TC-EC-033å­˜åœ¨äºåœºæ™¯14ï¼ˆæ ¼å¼åˆ·ç›¸å…³ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ç”¨ä¾‹å·²æ·»åŠ åˆ°TEST_PLAN.md
- [ ] æ‰€æœ‰è¡¨æ ¼ä¸­çš„ç”¨ä¾‹æ•°ä¿æŒä¸€è‡´
- [ ] æ‰€æœ‰æ—¶é—´ä¼°ç®—ä¿æŒä¸€è‡´
